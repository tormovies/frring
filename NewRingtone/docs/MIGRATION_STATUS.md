# Перенос FreeRingtones: что сделано и что дальше

## ✅ Уже сделано

### Данные и импорт
- **Категории** — импорт из `cats` + SEO из `seo` (CAT) → title, description, h1.
- **Материалы (рингтоны)** — из `ringtone` + SEO (ITE) → name, slug, title, description, h1, файл (mp4), размер, битрейт, длительность (из width), просмотры/лайки/скачивания (downloads = plays), дата, описание, исполнители (Authors), теги из seo_keywords.
- **Связи** — материал ↔ категория, материал ↔ теги, материал ↔ авторы.
- **Страницы** — импорт из `pages` + SEO (PAG) → name, slug, title, description, h1, content.
- **Синхронизация** — при повторном запуске без `--fresh` подтягиваются статистика, длительность, дата, описание, авторы (Observer не затирает длительность при внешнем CDN).

### URL и поведение как на старом сайте
- Рингтоны: `/play/{slug}.html`.
- Категории: `/category/{slug}.html`, популярные `/category/index-0-plays.html`, хиты `/category/index-0-rating.html`.
- Страницы: `/page/{slug}.html`.
- Поиск: `/search.php?query=...`.
- Ссылки на автора ведут на поиск по имени (как раньше).
- Редиректы 301 со старых URL нового сайта (`/materials/{slug}` и т.д.) на новый формат.

### SEO
- У материалов, категорий, тегов, типов, страниц, статей — свои поля title, description, h1, правятся в админке в каждом ресурсе.
- Общие шаблоны (главная, поиск, популярные, лучшие, статьи) — таблица `seo_templates`, страница в админке «SEO шаблоны».
- Подстановки: `%year%`, `%page%`, для поиска `%query%`.

### Админка и утилиты
- Filament: материалы, категории, теги, типы, авторы, страницы, статьи, пользователи, роли.
- Команды: `import:old-site`, `import:inspect-old {slug}`, `import:inspect-seo`, `make:admin`, `shield:super-admin-permissions`.
- Sitemap: `/sitemap.xml`, кеш, обновление из админки (SEO страница).

---

## Дальше по переносу (по приоритету)

### 1. Контент и файлы
- **Аудио** — в новой БД хранятся пути к файлам (например на cp1.freeringtones.ru). Проверить, что диск `mp4` в `config/filesystems.php` указывает на нужный URL/путь и скачивание работает.
- **Картинки (превью)** — поле `img` у материалов: откуда тянются (тот же хост или свой storage), при необходимости скопировать файлы и поправить пути.

### 2. Редиректы со старого домена (если меняется домен/структура)
- Если старый сайт был на `freeringtones.ru`, а новый на том же домене — структура URL уже совпадает (`/play/...`, `/category/...`), отдельные редиректы не нужны.
- Если старый и новый домены разные — в Nginx/Apache или в Laravel добавить 301 с каждого старого URL на новый (например `https://old.ru/play/yarik-bachok.html` → `https://new.ru/play/yarik-bachok.html`).

### 3. Проверка после импорта
- Прогнать `php artisan import:inspect-seo` и убедиться, что выбранные материалы/категории/страницы с собственным SEO совпадают в старой и новой БД.
- Вручную проверить: главная, поиск, одна категория, один рингтон (плеер, скачивание), одна страница.
- Проверить, что в админке редактирование SEO (у материала, категории, в «SEO шаблоны») сохраняется и отображается на сайте.

### 4. Пользователи и авторизация
- Старых пользователей мы не импортировали. Если нужно перенести учётки — написать шаг импорта из старой таблицы пользователей (логин/email, хеши паролей или сброс пароля).
- Регистрация/вход на новом сайте уже есть; при необходимости подправить под старые роли (например «автор»).

### 5. Продакшен
- Настроить `.env` для продакшена (APP_ENV=production, APP_DEBUG=false, правильная БД, кеш).
- Настроить очередь и планировщик (если появятся фоновые задачи или периодическое обновление sitemap).
- После выката один раз выполнить миграции и при необходимости импорт: `php artisan migrate --force`, `php artisan import:old-site` (и при необходимости `php artisan shield:super-admin-permissions`).

---

## Команды для проверки

```bash
# Импорт (повторно без --fresh — только досинхронизация)
php artisan import:old-site

# Пример рингтона из старой БД
php artisan import:inspect-old yarik-bachok

# Сравнение SEO старая vs новая БД (материал, категория, страница)
php artisan import:inspect-seo
```

Дальше по переносу логично идти в таком порядке: файлы и скачивание → редиректы (если два домена) → проверка страниц и SEO → пользователи (если нужны) → выкладка в прод.
